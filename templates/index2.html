<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcriere Video/Audio în SRT cu Whisper + Suport pentru Fișiere Mari (până la 20GB)</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1200px;
            padding: 30px;
            margin: 20px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
            font-size: 2.2em;
            font-weight: 300;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            font-size: 1.1em;
        }
        
        /* Large File Warning */
        .large-file-warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .large-file-warning i {
            color: #e67e22;
            margin-right: 10px;
        }
        
        /* Translation Panel */
        .translation-panel {
            background: #f0f9ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #90cdf4;
            animation: fadeIn 0.5s;
        }
        
        .translation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .translation-header h3 {
            color: #2b6cb0;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
        }
        
        .translation-toggle {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .translation-toggle:hover {
            background: #3182ce;
        }
        
        .translation-toggle.active {
            background: #2b6cb0;
        }
        
        .translation-controls {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 15px;
            align-items: center;
        }
        
        .translation-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .translation-selector label {
            color: #2b6cb0;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .translation-status {
            background: #c6f6d5;
            color: #22543d;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        .translation-status.active {
            display: flex;
        }
        
        .translation-status.translating {
            background: #fefcbf;
            color: #744210;
        }
        
        /* Model Selector */
        .model-selector {
            background: #f8f9ff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .model-selector h3 {
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .model-selector h3 i {
            color: #667eea;
        }
        
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .model-option {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .model-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .model-option.selected {
            border-color: #667eea;
            background: #f0f4ff;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .model-name {
            font-weight: bold;
            color: #4a5568;
            font-size: 1.em;
            margin-bottom: 5px;
        }
        
        .model-size {
            color: #718096;
            font-size: 0.85em;
            background: #edf2f7;
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
            margin-bottom: 6px;
        }
        
        .model-desc {
            color: #4a5568;
            font-size: 0.85em;
            line-height: 1.3;
        }
        
        .model-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #cbd5e0;
        }
        
        .model-status.loaded {
            background: #48bb78;
        }
        
        /* Settings Panel */
        .settings-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .settings-card {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e2e8f0;
        }
        
        .settings-card h3 {
            color: #4a5568;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1em;
        }
        
        .language-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        select {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: white;
            color: #4a5568;
            font-size: 0.95em;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        select:hover, select:focus {
            border-color: #667eea;
            outline: none;
        }
        
        .segmentation-controls {
            margin-top: 15px;
        }
        
        .control-group {
            margin-bottom: 12px;
        }
        
        .control-group label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            color: #4a5568;
            font-size: 0.9em;
        }
        
        .control-value {
            color: #667eea;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            color: #4a5568;
            font-size: 0.9em;
            cursor: pointer;
        }
        
        /* Upload Area */
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background: #f8f9ff;
        }
        
        .upload-area:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }
        
        .upload-area.highlight {
            background: #e8ebff;
            border-color: #4c51bf;
        }
        
        .upload-area.large-file {
            border-color: #e67e22;
            background: #fff9e6;
        }
        
        .upload-area.large-file:hover {
            background: #fff5d6;
            border-color: #d35400;
        }
        
        .upload-icon {
            font-size: 40px;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .upload-area.large-file .upload-icon {
            color: #e67e22;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-text {
            font-size: 1em;
            color: #555;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .file-info {
            color: #888;
            font-size: 0.85em;
        }
        
        /* Format Info */
        .format-info {
            background: #e6fffa;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .format-info.large-file {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
        }
        
        .format-info i {
            color: #234e52;
            margin-right: 8px;
        }
        
        .format-info.large-file i {
            color: #e67e22;
        }
        
        .format-info span {
            color: #234e52;
            font-size: 0.9em;
        }
        
        .format-info.large-file span {
            color: #744210;
        }
        
        /* Video Preview Container */
        .video-preview-container {
            display: none;
            margin-bottom: 20px;
            background: #1a202c;
            border-radius: 12px;
            overflow: hidden;
            animation: fadeIn 0.5s;
        }
        
        .video-wrapper {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            background: #000;
        }
        
        #videoPreview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            display: none;
        }
        
        #imagePreview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
            display: none;
        }
        
        .subtitle-overlay {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            text-align: center;
            max-width: 90%;
            font-size: 1.2em;
            line-height: 1.4;
            z-index: 10;
            transition: opacity 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            display: none;
        }
        
        #currentSubtitle {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .subtitle-timestamp {
            font-size: 0.8em;
            color: #a0aec0;
            opacity: 0.9;
        }
        
        .video-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: #2d3748;
            color: white;
        }
        
        .control-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .time-display {
            font-family: monospace;
            font-size: 1em;
            min-width: 80px;
            text-align: center;
        }
        
        .play-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .play-btn:hover {
            background: #764ba2;
            transform: scale(1.05);
        }
        
        /* Progress bar pentru video */
        .video-progress {
            flex: 1;
            height: 4px;
            background: #4a5568;
            margin: 0 15px;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }
        
        .video-progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: #667eea;
            border-radius: 2px;
            width: 0%;
        }
        
        .video-progress:hover .video-progress-fill {
            background: #764ba2;
        }
        
        /* Segments Preview */
        .segments-preview {
            display: none;
            background: #f8f9ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
            animation: fadeIn 0.5s;
        }
        
        .preview-segment {
            background: white;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .preview-segment-header {
            display: flex;
            justify-content: space-between;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.85em;
        }
        
        .preview-segment-text {
            color: #333;
            line-height: 1.4;
            font-size: 0.95em;
        }
        
        /* Upload Progress Details */
        .upload-details {
            background: #f8f9ff;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .upload-details h4 {
            color: #4a5568;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .upload-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        
        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.85em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            color: #4a5568;
            font-weight: bold;
            font-size: 1em;
        }
        
        .chunk-info {
            margin-top: 10px;
            padding: 10px;
            background: #edf2f7;
            border-radius: 8px;
            font-size: 0.9em;
            color: #4a5568;
        }
        
        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #718096;
        }
        
        .btn-secondary:hover {
            background: #4a5568;
        }
        
        .btn-large-file {
            background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);
        }
        
        .btn-large-file:hover {
            background: linear-gradient(135deg, #d35400 0%, #a52714 100%);
        }
        
        .download-btn {
            background: #48bb78;
        }
        
        .download-btn:hover {
            background: #38a169;
        }
        
        .btn-danger {
            background: #e53e3e;
        }
        
        .btn-danger:hover {
            background: #c53030;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        /* Loading */
        .loading {
            display: none;
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 15px;
            animation: fadeIn 0.5s;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .loading.large-file .spinner {
            border-top-color: #e67e22;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Results */
        .result-container {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .segments {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
        }
        
        .segment {
            background: #f8f9ff;
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }
        
        .segment.highlighted {
            background: #e6fffa !important;
            border-left: 4px solid #48bb78 !important;
        }
        
        .segment-header {
            display: flex;
            justify-content: space-between;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.85em;
        }
        
        .segment-text {
            color: #333;
            line-height: 1.4;
        }
        
        .full-text {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            line-height: 1.6;
            max-height: 200px;
            overflow-y: auto;
        }
        
        /* System Info */
        .system-info {
            background: #e6fffa;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            font-size: 0.85em;
            color: #234e52;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .info-label {
            font-weight: bold;
        }
        
        /* Status Bar */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 12px;
            background: #f8f9ff;
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .status-badge {
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .status-badge.large-file {
            background: #e67e22;
        }
        
        /* Errors and Preview */
        .error {
            color: #e53e3e;
            background: #fed7d7;
            padding: 12px;
            border-radius: 10px;
            margin: 15px 0;
            text-align: center;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        /* Progress Bar */
        .progress-container {
            margin: 15px 0;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-container.large-file .progress-fill {
            background: linear-gradient(90deg, #e67e22, #d35400);
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            color: #4a5568;
            font-size: 0.85em;
        }
        
        /* Processing Info */
        .processing-info {
            background: #f0f4ff;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 10px;
        }
        
        .info-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .info-card.large-file {
            border-left-color: #e67e22;
        }
        
        .info-card h4 {
            color: #4a5568;
            margin-bottom: 5px;
            font-size: 0.85em;
        }
        
        .info-card p {
            color: #667eea;
            font-weight: bold;
            font-size: 1em;
        }
        
        .info-card.large-file p {
            color: #e67e22;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .toast.success {
            background: #48bb78;
        }
        
        .toast.error {
            background: #e53e3e;
        }
        
        .toast.info {
            background: #667eea;
        }
        
        .toast.warning {
            background: #e67e22;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Manual scroll button */
        .scroll-to-current {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #667eea;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 100;
            transition: all 0.3s;
        }
        
        .scroll-to-current:hover {
            background: #764ba2;
            transform: scale(1.1);
        }
        
        /* Debug Console */
        .debug-console {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 0.8em;
            max-width: 400px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            border: 1px solid #0f0;
        }
        
        .debug-toggle {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: #805ad5;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            z-index: 1001;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .settings-panel {
                grid-template-columns: 1fr;
            }
            
            .model-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .video-controls {
                flex-wrap: wrap;
            }
            
            .time-display {
                font-size: 0.9em;
                min-width: 70px;
            }
            
            .play-btn {
                padding: 6px 15px;
                font-size: 0.9em;
            }
            
            .translation-controls {
                grid-template-columns: 1fr;
            }
            
            .upload-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-closed-captioning"></i> Transcriere Video/Audio în SRT</h1>
        <p class="subtitle">Cu suport pentru fișiere mari până la 20GB și upload optimizat</p>
        
        <!-- Large File Warning -->
        <div class="large-file-warning" id="largeFileWarning">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="largeFileWarningText"></span>
        </div>
        
        <!-- System Info -->
        <div class="system-info" id="systemInfo">
            <div class="info-item">
                <i class="fas fa-microchip"></i>
                <span id="deviceInfo">Se încarcă...</span>
            </div>
            <div class="info-item">
                <i class="fas fa-hdd"></i>
                <span id="memoryInfo">Se încarcă...</span>
            </div>
            <div class="info-item">
                <i class="fas fa-upload"></i>
                <span id="uploadLimitInfo">Limită: 20GB</span>
            </div>
        </div>
        
        <!-- Translation Panel -->
        <div class="translation-panel" id="translationPanel">
            <div class="translation-header">
                <h3><i class="fas fa-language"></i> Traducere Subtitrări</h3>
                <button class="translation-toggle" id="toggleTranslation">
                    <i class="fas fa-toggle-off"></i> Dezactivată
                </button>
            </div>
            
            <div class="translation-controls" id="translationControls" style="display: none;">
                <div class="translation-selector">
                    <label for="translationSelect"><i class="fas fa-globe-americas"></i> Traducere în:</label>
                    <select id="translationSelect">
                        <option value="">-- Selectează limba țintă --</option>
                        <!-- Languages will be populated by JavaScript -->
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Settings Panel -->
        <div class="settings-panel">
            <!-- Model Selection -->
            <div class="settings-card">
                <h3><i class="fas fa-brain"></i> Selectare Model Whisper</h3>
                <div class="model-grid" id="modelGrid">
                    <!-- Models will be loaded here -->
                </div>
            </div>
            
            <!-- Language & Segmentation -->
            <div class="settings-card">
                <h3><i class="fas fa-language"></i> Setări Limbă și Segmentare</h3>
                
                <div class="language-selector">
                    <label for="languageSelect"><i class="fas fa-globe"></i> Limbă:</label>
                    <select id="languageSelect">
                        <option value="auto">Detectare automată</option>
                        <!-- Languages will be populated by JavaScript -->
                    </select>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="adjustSegmentation" checked>
                    <label for="adjustSegmentation">Ajustare automată segmentare pentru subtitrări</label>
                </div>
                
                <div class="segmentation-controls" id="segmentationControls">
                    <div class="control-group">
                        <label>
                            <span>Durata minimă segment (sec):</span>
                            <span class="control-value" id="minDurationValue">1.0s</span>
                        </label>
                        <input type="range" id="minDuration" min="0.5" max="3.0" step="0.1" value="1.0">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            <span>Durata maximă segment (sec):</span>
                            <span class="control-value" id="maxDurationValue">5.0s</span>
                        </label>
                        <input type="range" id="maxDuration" min="3.0" max="10.0" step="0.1" value="5.0">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            <span>Caractere maxime pe segment:</span>
                            <span class="control-value" id="maxCharsValue">80</span>
                        </label>
                        <input type="range" id="maxChars" min="40" max="120" step="1" value="80">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Bar -->
        <div class="status-bar">
            <div>
                <strong>Setări curente:</strong>
                <span class="status-badge" id="currentModel">small</span>
                <span class="status-badge" id="currentLanguage">auto</span>
                <span class="status-badge" id="translationBadge" style="display: none;">
                    <i class="fas fa-language"></i> Traducere
                </span>
                <span class="status-badge" id="segmentationStatus">Segmentare: ON</span>
                <span class="status-badge" id="fileSizeBadge" style="display: none;">
                    <i class="fas fa-file"></i> <span id="fileSizeText">0 MB</span>
                </span>
            </div>
            <div class="formats">
                <span style="color: #718096; font-size: 0.85em;">
                    Formate acceptate: MP4, AVI, MOV, MKV, MXF, WMV, FLV, MP3, WAV (Max: 20GB)
                </span>
            </div>
        </div>
        
        <!-- Format Info -->
        <div class="format-info" id="formatInfo">
            <i class="fas fa-info-circle"></i>
            <span id="formatInfoText"></span>
        </div>
        
        <!-- Upload Details -->
        <div class="upload-details" id="uploadDetails">
            <h4><i class="fas fa-chart-line"></i> Detalii Upload</h4>
            <div class="upload-stats">
                <div class="stat-item">
                    <div class="stat-label">Dimensiune totală</div>
                    <div class="stat-value" id="statTotalSize">0 MB</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Chunks</div>
                    <div class="stat-value" id="statChunks">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Chunk curent</div>
                    <div class="stat-value" id="statCurrentChunk">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Viteza estimată</div>
                    <div class="stat-value" id="statSpeed">0 MB/s</div>
                </div>
            </div>
            <div class="chunk-info" id="chunkInfo">
                <i class="fas fa-sync-alt fa-spin"></i> Se pregătește upload-ul...
            </div>
        </div>
        
        <!-- Upload Area -->
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon"><i class="fas fa-file-upload"></i></div>
            <div class="upload-text" id="uploadText">Trage și plasează fișierul aici sau click pentru a selecta</div>
            <div class="file-info">
                Maxim 20GB • Upload optimizat pentru fișiere mari • MP4: Playback direct
            </div>
            <input type="file" class="file-input" id="fileInput" 
                   accept=".mp4,.avi,.mov,.mkv,.m4v,.mp3,.wav,.mpeg,.webm,.mxf,.wmv,.flv">
        </div>
        
        <!-- Video Preview -->
        <div class="video-preview-container" id="videoPreviewContainer">
            <div class="video-wrapper">
                <video id="videoPreview" controls>
                    <source id="videoSource" type="video/mp4">
                    Browser-ul tău nu suportă tag-ul video.
                </video>
                <img id="imagePreview" src="" alt="Image Preview">
                <div class="subtitle-overlay" id="subtitleOverlay">
                    <div id="currentSubtitle"></div>
                    <div class="subtitle-timestamp" id="subtitleTimestamp"></div>
                </div>
            </div>
            <div class="video-controls">
                <div class="time-display" id="currentTime">00:00:00</div>
                <button class="play-btn" id="playVideoBtn">
                    <i class="fas fa-play"></i> Play cu Subtitrări
                </button>
                <div class="time-display" id="totalTime">00:00:00</div>
            </div>
        </div>
        
        <!-- Quick Preview Segments -->
        <div class="segments-preview" id="segmentsPreview">
            <h3><i class="fas fa-eye"></i> Previzualizare Transcriere</h3>
            <div id="previewContent"></div>
        </div>
        
        <!-- Progress Bar -->
        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Se procesează...</div>
        </div>
        
        <!-- Error Message -->
        <div class="error" id="errorArea"></div>
        
        <!-- Button Group -->
        <div class="button-group">
            <button class="btn" id="processBtn" onclick="processFile()" disabled>
                <i class="fas fa-play"></i> Start Transcriere
            </button>
            <button class="btn btn-secondary" id="quickPreviewBtn" onclick="quickPreview()" disabled>
                <i class="fas fa-eye"></i> Previzualizare Rapidă
            </button>
            <button class="btn btn-danger" onclick="resetApp()">
                <i class="fas fa-redo"></i> Reset
            </button>
            <button class="btn btn-secondary" onclick="testUpload()" id="testUploadBtn">
                <i class="fas fa-vial"></i> Test Upload
            </button>
        </div>
        
        <!-- Processing Info -->
        <div class="processing-info" id="processingInfo">
            <h3><i class="fas fa-info-circle"></i> Informații procesare:</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>Model folosit</h4>
                    <p id="infoModel">-</p>
                </div>
                <div class="info-card">
                    <h4>Timp procesare</h4>
                    <p id="infoTime">-</p>
                </div>
                <div class="info-card">
                    <h4>Limbă detectată</h4>
                    <p id="infoLanguage">-</p>
                </div>
                <div class="info-card">
                    <h4>Dimensiune fișier</h4>
                    <p id="infoFileSize">-</p>
                </div>
            </div>
        </div>
        
        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Se procesează... Vă rugăm să așteptați.</p>
            <p id="loadingDetails" style="margin-top: 10px; color: #718096; font-size: 0.9em;">
                <i class="fas fa-info-circle"></i> <span id="loadingDetailText"></span>
            </p>
        </div>
        
        <!-- Results -->
        <div class="result-container" id="resultContainer">
            <h2><i class="fas fa-check-circle"></i> Transcriere finalizată!</h2>
            
            <div class="full-text" id="fullText"></div>
            
            <h3><i class="fas fa-list"></i> Segmente cu timecode:</h3>
            <div class="segments" id="segmentsList"></div>
            
            <div class="button-group">
                <button class="btn download-btn" onclick="downloadSRT()">
                    <i class="fas fa-download"></i> Descarcă Fișier SRT
                </button>
                <button class="btn btn-secondary" onclick="playWithSubtitles()" id="playWithSubtitlesBtn">
                    <i class="fas fa-film"></i> Play cu Subtitrări
                </button>
            </div>
        </div>
    </div>
    
    <!-- Scroll to Current Button -->
    <button class="scroll-to-current" id="scrollToCurrentBtn" onclick="scrollToCurrentSegment()" title="Scroll la subtitrarea curentă">
        <i class="fas fa-arrow-down"></i>
    </button>
    
    <!-- Debug Console -->
    <button class="debug-toggle" onclick="toggleDebugConsole()">Debug Console</button>
    <div class="debug-console" id="debugConsole"></div>
    
    <script>
        let selectedFile = null;
        let srtFilename = '';
        let currentModel = '{{ selected_model }}';
        let currentLanguage = '{{ selected_language }}';
        let translationTarget = '{{ translation_target }}' !== 'None' ? '{{ translation_target }}' : null;
        let segmentationSettings = {{ segmentation_settings|tojson }};
        let modelsStatus = {};
        let currentSegments = [];
        let originalSegments = [];
        let videoPreviewUrl = null;
        let imagePreviewUrl = null;
        let processId = null;
        let isVideoFile = false;
        let isMp4File = false;
        let videoDuration = 0;
        let previewSegments = [];
        let videoPlaying = false;
        let currentSegmentIndex = -1;
        let videoPlayInterval = null;
        let translationEnabled = false;
        
        // Variabile pentru upload chunked
        let uploadId = null;
        let uploadCheckInterval = null;
        let uploadStartTime = null;
        let totalChunks = 0;
        let currentChunk = 0;
        let isLargeFile = false;
        
        // Elemente DOM
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadText = document.getElementById('uploadText');
        const processBtn = document.getElementById('processBtn');
        const quickPreviewBtn = document.getElementById('quickPreviewBtn');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('resultContainer');
        const errorArea = document.getElementById('errorArea');
        const currentModelElement = document.getElementById('currentModel');
        const currentLanguageElement = document.getElementById('currentLanguage');
        const translationBadge = document.getElementById('translationBadge');
        const segmentationStatusElement = document.getElementById('segmentationStatus');
        const modelGrid = document.getElementById('modelGrid');
        const languageSelect = document.getElementById('languageSelect');
        const adjustSegmentationCheckbox = document.getElementById('adjustSegmentation');
        const segmentationControls = document.getElementById('segmentationControls');
        const minDurationSlider = document.getElementById('minDuration');
        const maxDurationSlider = document.getElementById('maxDuration');
        const maxCharsSlider = document.getElementById('maxChars');
        const minDurationValue = document.getElementById('minDurationValue');
        const maxDurationValue = document.getElementById('maxDurationValue');
        const maxCharsValue = document.getElementById('maxCharsValue');
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        const videoPreview = document.getElementById('videoPreview');
        const imagePreview = document.getElementById('imagePreview');
        const subtitleOverlay = document.getElementById('subtitleOverlay');
        const currentSubtitle = document.getElementById('currentSubtitle');
        const subtitleTimestamp = document.getElementById('subtitleTimestamp');
        const playVideoBtn = document.getElementById('playVideoBtn');
        const currentTimeElement = document.getElementById('currentTime');
        const totalTimeElement = document.getElementById('totalTime');
        const segmentsPreview = document.getElementById('segmentsPreview');
        const previewContent = document.getElementById('previewContent');
        const systemInfo = document.getElementById('systemInfo');
        const deviceInfo = document.getElementById('deviceInfo');
        const memoryInfo = document.getElementById('memoryInfo');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const processingInfo = document.getElementById('processingInfo');
        const infoModel = document.getElementById('infoModel');
        const infoTime = document.getElementById('infoTime');
        const infoLanguage = document.getElementById('infoLanguage');
        const infoFileSize = document.getElementById('infoFileSize');
        const playWithSubtitlesBtn = document.getElementById('playWithSubtitlesBtn');
        const scrollToCurrentBtn = document.getElementById('scrollToCurrentBtn');
        const formatInfo = document.getElementById('formatInfo');
        const formatInfoText = document.getElementById('formatInfoText');
        const translationPanel = document.getElementById('translationPanel');
        const toggleTranslationBtn = document.getElementById('toggleTranslation');
        const translationControls = document.getElementById('translationControls');
        const translationSelect = document.getElementById('translationSelect');
        const loadingDetailText = document.getElementById('loadingDetailText');
        const loadingDetails = document.getElementById('loadingDetails');
        const fileSizeBadge = document.getElementById('fileSizeBadge');
        const fileSizeText = document.getElementById('fileSizeText');
        const largeFileWarning = document.getElementById('largeFileWarning');
        const largeFileWarningText = document.getElementById('largeFileWarningText');
        const uploadDetails = document.getElementById('uploadDetails');
        const statTotalSize = document.getElementById('statTotalSize');
        const statChunks = document.getElementById('statChunks');
        const statCurrentChunk = document.getElementById('statCurrentChunk');
        const statSpeed = document.getElementById('statSpeed');
        const chunkInfo = document.getElementById('chunkInfo');
        const testUploadBtn = document.getElementById('testUploadBtn');
        const debugConsole = document.getElementById('debugConsole');
        
        // Debug logging
        function debugLog(message) {
            const now = new Date().toLocaleTimeString();
            const logMessage = `[${now}] ${message}`;
            console.log(logMessage);
            
            // Adaugă în consola debug
            if (debugConsole.style.display === 'block') {
                debugConsole.innerHTML = logMessage + '<br>' + debugConsole.innerHTML;
                if (debugConsole.children.length > 20) {
                    debugConsole.removeChild(debugConsole.lastChild);
                }
            }
        }
        
        function toggleDebugConsole() {
            if (debugConsole.style.display === 'block') {
                debugConsole.style.display = 'none';
            } else {
                debugConsole.style.display = 'block';
            }
        }
        
        // Inițializare
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentModel();
            updateCurrentLanguage();
            updateSegmentationStatus();
            loadModels();
            loadLanguages();
            loadTranslationLanguages();
            loadSystemInfo();
            loadModelStatus();
            
            // Ascultă evenimente pentru controale
            minDurationSlider.addEventListener('input', updateSegmentationSettings);
            maxDurationSlider.addEventListener('input', updateSegmentationSettings);
            maxCharsSlider.addEventListener('input', updateSegmentationSettings);
            adjustSegmentationCheckbox.addEventListener('change', toggleSegmentationControls);
            languageSelect.addEventListener('change', updateLanguage);
            translationSelect.addEventListener('change', updateTranslationTarget);
            toggleTranslationBtn.addEventListener('click', toggleTranslation);
            
            // Inițializează controalele de segmentare
            minDurationSlider.value = segmentationSettings.min_duration;
            maxDurationSlider.value = segmentationSettings.max_duration;
            maxCharsSlider.value = segmentationSettings.max_chars;
            adjustSegmentationCheckbox.checked = segmentationSettings.adjust_segmentation;
            toggleSegmentationControls();
            updateSliderValues();
            
            // Inițializează traducerea
            translationEnabled = translationTarget !== null && translationTarget !== '' && translationTarget !== 'None';
            updateTranslationUI();
            
            // Verifică statusul modelelor periodic
            setInterval(loadModelStatus, 10000);
            
            // Afișează un mesaj de bun venit
            setTimeout(() => {
                showToast(`Aplicația este gata! Suport pentru fișiere mari până la 20GB.`, 'success');
            }, 1000);
        });
        
        // Încarcă modelele disponibile
        async function loadModels() {
            try {
                const response = await fetch('/get_models');
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                modelGrid.innerHTML = '';
                data.models.forEach(model => {
                    const isSelected = model.id === currentModel;
                    const modelElement = document.createElement('div');
                    modelElement.className = `model-option ${isSelected ? 'selected' : ''}`;
                    modelElement.innerHTML = `
                        <div class="model-name">${model.name}</div>
                        <div class="model-size">${model.size}</div>
                        <div class="model-desc">${model.description}</div>
                        <div class="model-status ${modelsStatus[model.id]?.loaded ? 'loaded' : ''}" 
                             id="status-${model.id}"></div>
                    `;
                    
                    modelElement.onclick = () => selectModel(model.id);
                    modelGrid.appendChild(modelElement);
                });
            } catch (error) {
                console.error('Eroare la încărcarea modelelor:', error);
                showToast('Eroare la încărcarea modelelor', 'error');
            }
        }
        
        // Încarcă limbile disponibile
        async function loadLanguages() {
            try {
                const response = await fetch('/get_languages');
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                languageSelect.innerHTML = '<option value="auto">Detectare automată</option>';
                data.languages.forEach(lang => {
                    if (lang.code !== 'auto') {
                        const option = document.createElement('option');
                        option.value = lang.code;
                        option.textContent = `${lang.name} (${lang.code})`;
                        option.selected = lang.selected;
                        languageSelect.appendChild(option);
                    }
                });
            } catch (error) {
                console.error('Eroare la încărcarea limbilor:', error);
            }
        }
        
        // Încarcă limbile pentru traducere
        async function loadTranslationLanguages() {
            try {
                const response = await fetch('/get_translation_languages');
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                translationSelect.innerHTML = '<option value="">-- Selectează limba țintă --</option>';
                data.translation_languages.forEach(lang => {
                    const option = document.createElement('option');
                    option.value = lang.code;
                    option.textContent = `${lang.name} (${lang.code})`;
                    option.selected = lang.selected;
                    translationSelect.appendChild(option);
                });
                
                // Dacă avem o limbă țintă setată, o selectăm
                if (data.current_target) {
                    translationSelect.value = data.current_target;
                }
            } catch (error) {
                console.error('Eroare la încărcarea limbilor de traducere:', error);
            }
        }
        
        // Încarcă statusul modelelor
        async function loadModelStatus() {
            try {
                const response = await fetch('/model_status');
                const data = await response.json();
                if (data.error) throw new Error(data.error);
                
                modelsStatus = data.status;
                
                // Actualizează indicatorii de status
                for (const modelId in modelsStatus) {
                    const statusElement = document.getElementById(`status-${modelId}`);
                    if (statusElement) {
                        if (modelsStatus[modelId].loaded) {
                            statusElement.className = 'model-status loaded';
                            statusElement.title = `Încărcat pe ${modelsStatus[modelId].device}`;
                        } else {
                            statusElement.className = 'model-status';
                            statusElement.title = 'Nu este încărcat';
                        }
                    }
                }
            } catch (error) {
                console.error('Eroare la încărcarea statusului:', error);
            }
        }
        
        // Încarcă informații sistem
        async function loadSystemInfo() {
            try {
                const response = await fetch('/system_info');
                const data = await response.json();
                
                if (data.error) throw new Error(data.error);
                
                deviceInfo.textContent = `CPU: ${data.cpu_count} cores`;
                memoryInfo.textContent = `Memorie: ${data.available_memory}`;
                
            } catch (error) {
                console.error('Eroare la încărcarea informațiilor sistem:', error);
            }
        }
        
        // Selectează modelul
        async function selectModel(modelId) {
            try {
                const response = await fetch('/set_model', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ model: modelId })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentModel = modelId;
                    updateCurrentModel();
                    loadModels();
                    showToast(`Model setat la: ${modelId}`, 'success');
                } else {
                    throw new Error(data.error || 'Eroare necunoscută');
                }
            } catch (error) {
                console.error('Eroare la selectarea modelului:', error);
                showToast('Eroare la schimbarea modelului', 'error');
            }
        }
        
        // Actualizează limba
        async function updateLanguage() {
            const language = languageSelect.value;
            try {
                const response = await fetch('/set_language', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ language: language })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentLanguage = language;
                    updateCurrentLanguage();
                    showToast(data.message, 'success');
                }
            } catch (error) {
                console.error('Eroare la actualizarea limbii:', error);
            }
        }
        
        // Actualizează limba țintă pentru traducere
        async function updateTranslationTarget() {
            const targetLanguage = translationSelect.value;
            
            if (!targetLanguage) {
                translationEnabled = false;
                updateTranslationUI();
                return;
            }
            
            try {
                const response = await fetch('/set_translation_target', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ target_language: targetLanguage })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    translationTarget = targetLanguage;
                    translationEnabled = true;
                    updateTranslationUI();
                    showToast(data.message, 'success');
                } else {
                    throw new Error(data.error || 'Eroare necunoscută');
                }
            } catch (error) {
                console.error('Eroare la actualizarea limbii țintă:', error);
                showToast('Eroare la setarea traducerii', 'error');
            }
        }
        
        // Activează/dezactivează traducerea
        function toggleTranslation() {
            translationEnabled = !translationEnabled;
            
            if (translationEnabled) {
                // Activează traducerea
                translationControls.style.display = 'grid';
                toggleTranslationBtn.innerHTML = '<i class="fas fa-toggle-on"></i> Activată';
                toggleTranslationBtn.classList.add('active');
                
                // Selectează prima limbă disponibilă dacă nu e selectată
                if (!translationSelect.value && translationSelect.options.length > 1) {
                    translationSelect.value = translationSelect.options[1].value;
                    updateTranslationTarget();
                }
            } else {
                // Dezactivează traducerea
                translationControls.style.display = 'none';
                toggleTranslationBtn.innerHTML = '<i class="fas fa-toggle-off"></i> Dezactivată';
                toggleTranslationBtn.classList.remove('active');
                translationTarget = null;
                translationEnabled = false;
                
                // Resetează selecția
                translationSelect.value = '';
                
                // Trimite cerere pentru a dezactiva traducerea
                fetch('/set_translation_target', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ target_language: '' })
                });
                
                showToast('Traducere dezactivată', 'info');
            }
            
            updateTranslationBadge();
        }
        
        // Actualizează interfața pentru traducere
        function updateTranslationUI() {
            if (translationEnabled && translationTarget) {
                translationControls.style.display = 'grid';
                toggleTranslationBtn.innerHTML = '<i class="fas fa-toggle-on"></i> Activată';
                toggleTranslationBtn.classList.add('active');
                translationSelect.value = translationTarget;
            } else {
                translationControls.style.display = 'none';
                toggleTranslationBtn.innerHTML = '<i class="fas fa-toggle-off"></i> Dezactivată';
                toggleTranslationBtn.classList.remove('active');
            }
            
            updateTranslationBadge();
        }
        
        // Actualizează badge-ul de traducere
        function updateTranslationBadge() {
            if (translationEnabled && translationTarget) {
                translationBadge.style.display = 'inline-block';
                translationBadge.innerHTML = `<i class="fas fa-language"></i> → ${translationTarget.toUpperCase()}`;
                translationBadge.title = `Traducere activă în ${translationTarget}`;
            } else {
                translationBadge.style.display = 'none';
            }
        }
        
        // Actualizează setările de segmentare
        async function updateSegmentationSettings() {
            updateSliderValues();
            
            segmentationSettings = {
                min_duration: parseFloat(minDurationSlider.value),
                max_duration: parseFloat(maxDurationSlider.value),
                max_chars: parseInt(maxCharsSlider.value),
                adjust_segmentation: adjustSegmentationCheckbox.checked
            };
            
            updateSegmentationStatus();
            
            try {
                const response = await fetch('/set_segmentation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(segmentationSettings)
                });
                
                const data = await response.json();
                if (!data.success) {
                    console.error('Eroare la salvarea setărilor:', data.error);
                }
            } catch (error) {
                console.error('Eroare la actualizarea setărilor:', error);
            }
        }
        
        // Actualizează valorile slider-elor
        function updateSliderValues() {
            minDurationValue.textContent = `${minDurationSlider.value}s`;
            maxDurationValue.textContent = `${maxDurationSlider.value}s`;
            maxCharsValue.textContent = maxCharsSlider.value;
        }
        
        // Activează/dezactivează controalele de segmentare
        function toggleSegmentationControls() {
            const isEnabled = adjustSegmentationCheckbox.checked;
            segmentationControls.style.opacity = isEnabled ? '1' : '0.5';
            segmentationControls.style.pointerEvents = isEnabled ? 'all' : 'none';
            updateSegmentationSettings();
        }
        
        // Actualizează afișajul modelului curent
        function updateCurrentModel() {
            currentModelElement.textContent = currentModel;
            currentModelElement.title = `Model curent: ${currentModel}`;
        }
        
        // Actualizează afișajul limbii curente
        function updateCurrentLanguage() {
            const languageName = languageSelect.options[languageSelect.selectedIndex].text;
            currentLanguageElement.textContent = currentLanguage === 'auto' ? 'auto' : currentLanguage;
            currentLanguageElement.title = `Limbă curentă: ${languageName}`;
        }
        
        // Actualizează statusul segmentării
        function updateSegmentationStatus() {
            const isEnabled = adjustSegmentationCheckbox.checked;
            segmentationStatusElement.textContent = isEnabled ? 
                `Segmentare: ON (${minDurationSlider.value}-${maxDurationSlider.value}s)` : 
                'Segmentare: OFF';
            segmentationStatusElement.title = isEnabled ? 
                `Durată: ${minDurationSlider.value}-${maxDurationSlider.value}s, Max ${maxCharsSlider.value} caractere` : 
                'Segmentare dezactivată';
        }
        
        // Evenimente drag and drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            uploadArea.classList.add('highlight');
        }
        
        function unhighlight() {
            uploadArea.classList.remove('highlight');
        }
        
        uploadArea.addEventListener('drop', handleDrop, false);
        uploadArea.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', handleFileSelect);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }
        
        function handleFileSelect() {
            handleFiles(this.files);
        }
        
        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const maxSize = 20 * 1024 * 1024 * 1024; // 20GB
            
            if (file.size > maxSize) {
                showError('Fișierul este prea mare. Maxim 20GB.');
                return;
            }
            
            // Verifică extensia
            const fileName = file.name.toLowerCase();
            const isSupportedVideo = ['.mp4', '.avi', '.mov', '.mkv', '.mxf', '.wmv', '.flv'].some(ext => 
                fileName.endsWith(ext));
            const isSupportedAudio = ['.mp3', '.wav', '.mpeg'].some(ext => 
                fileName.endsWith(ext));
            
            if (!isSupportedVideo && !isSupportedAudio) {
                showError('Format fișier neacceptat. Folosește MP4, AVI, MOV, MKV, MXF, WMV, FLV, MP3 sau WAV.');
                return;
            }
            
            selectedFile = file;
            isVideoFile = isSupportedVideo;
            isMp4File = fileName.endsWith('.mp4');
            const fileSizeMB = file.size / (1024 * 1024);
            isLargeFile = fileSizeMB > 100; // >100MB considerăm fișier mare
            
            // Actualizează badge-ul cu dimensiunea
            fileSizeBadge.style.display = 'inline-block';
            fileSizeText.textContent = `${fileSizeMB.toFixed(1)} MB`;
            
            if (isLargeFile) {
                fileSizeBadge.classList.add('large-file');
            } else {
                fileSizeBadge.classList.remove('large-file');
            }
            
            // Afișează informații despre format
            if (isLargeFile) {
                formatInfoText.textContent = `Fișier mare detectat: ${fileSizeMB.toFixed(1)} MB. Se va folosi upload optimizat în chunks.`;
                formatInfo.className = 'format-info large-file';
                formatInfo.style.display = 'block';
                
                largeFileWarningText.textContent = `Fișier mare (${fileSizeMB.toFixed(1)} MB). Upload-ul va fi în chunks pentru fiabilitate.`;
                largeFileWarning.style.display = 'block';
                
                uploadArea.classList.add('large-file');
            } else if (isMp4File) {
                formatInfoText.textContent = 'Fișier MP4 detectat: Se va folosi video original pentru playback direct.';
                formatInfo.className = 'format-info';
                formatInfo.style.display = 'block';
                uploadArea.classList.remove('large-file');
                largeFileWarning.style.display = 'none';
            } else if (isVideoFile) {
                const ext = fileName.substring(fileName.lastIndexOf('.'));
                formatInfoText.textContent = `Fișier ${ext.toUpperCase()} detectat: Se va converti la MP4 pentru compatibilitate browser.`;
                formatInfo.className = 'format-info';
                formatInfo.style.display = 'block';
                uploadArea.classList.remove('large-file');
                largeFileWarning.style.display = 'none';
            } else {
                formatInfo.style.display = 'none';
                uploadArea.classList.remove('large-file');
                largeFileWarning.style.display = 'none';
            }
            
            uploadText.innerHTML = `<i class="fas fa-file-alt"></i> ${file.name} (${formatFileSize(file.size)})`;
            processBtn.disabled = false;
            quickPreviewBtn.disabled = false;
            
            // Ascunde rezultatele anterioare
            resultContainer.style.display = 'none';
            processingInfo.style.display = 'none';
            segmentsPreview.style.display = 'none';
            videoPreviewContainer.style.display = 'none';
            uploadDetails.style.display = 'none';
            hideError();
            hideScrollButton();
            
            // Reset video preview
            videoPreview.style.display = 'none';
            imagePreview.style.display = 'none';
            videoPreview.src = '';
            imagePreview.src = '';
            
            // Pentru fișiere mari (>200MB), nu încerca preview automat
            if (isVideoFile && !isLargeFile) {
                extractVideoPreview(file);
            } else if (isVideoFile && isLargeFile) {
                showToast('Fișier prea mare pentru preview automat. Upload optimizat va fi folosit.', 'warning');
            }
            
            debugLog(`Fișier selectat: ${file.name} (${fileSizeMB.toFixed(1)} MB)`);
        }
        
        // Formatează dimensiunea fișierului
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Extrage preview video
        async function extractVideoPreview(file) {
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch('/video_preview', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success && data.is_video) {
                    // Afișează preview video ca imagine
                    imagePreview.src = data.preview_url;
                    imagePreview.style.display = 'block';
                    videoDuration = data.duration;
                    
                    totalTimeElement.textContent = formatTime(videoDuration);
                    videoPreviewContainer.style.display = 'block';
                    
                    // Configurează butonul de play
                    playVideoBtn.onclick = () => playVideoWithSubtitles();
                    playVideoBtn.innerHTML = '<i class="fas fa-play"></i> Play cu Subtitrări';
                    videoPlaying = false;
                    
                    showToast('Preview video extras cu succes!', 'success');
                }
            } catch (error) {
                console.error('Eroare la extragerea preview video:', error);
            }
        }
        
        // Previzualizare rapidă
        async function quickPreview() {
            if (!selectedFile) return;
            
            hideError();
            segmentsPreview.style.display = 'block';
            previewContent.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Se procesează previzualizarea...</p>';
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            try {
                const response = await fetch('/preview_transcription', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    previewSegments = data.preview;
                    
                    let html = `<p><small>Model: ${data.model_used}, Limbă detectată: ${data.detected_language}</small></p>`;
                    
                    previewSegments.forEach(segment => {
                        html += `
                            <div class="preview-segment">
                                <div class="preview-segment-header">
                                    <span>#${segment.id}</span>
                                    <span>${segment.start_formatted} → ${segment.end_formatted}</span>
                                </div>
                                <div class="preview-segment-text">${segment.text}</div>
                            </div>
                        `;
                    });
                    
                    if (data.has_more) {
                        html += `<p style="text-align: center; color: #718096; margin-top: 10px;">
                            <i class="fas fa-ellipsis-h"></i> și încă ${data.total_segments - previewSegments.length} segmente
                        </p>`;
                    }
                    
                    previewContent.innerHTML = html;
                    
                    if (isVideoFile) {
                        showToast('Previzualizare completă! Poți testa sincronizarea cu video.', 'success');
                    }
                } else {
                    throw new Error(data.error || 'Eroare la previzualizare');
                }
            } catch (error) {
                showError(`Eroare previzualizare: ${error.message}`);
                segmentsPreview.style.display = 'none';
            }
        }
        
        // Test Upload simplu
        async function testUpload() {
            if (!selectedFile) {
                showError('Selectează un fișier mai întâi.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', selectedFile);
            
            try {
                showToast('Test upload în curs...', 'info');
                const response = await fetch('/simple_upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showToast(`Test reușit! Fișier primit: ${data.size_mb.toFixed(1)} MB`, 'success');
                    debugLog(`Test upload reușit: ${data.size_mb.toFixed(1)} MB`);
                } else {
                    throw new Error(data.error || 'Eroare la test');
                }
            } catch (error) {
                showToast(`Test eșuat: ${error.message}`, 'error');
                debugLog(`Test upload eșuat: ${error.message}`);
            }
        }
        
        // Procesează fișierul complet
        async function processFile() {
            if (!selectedFile) return;
            
            // Resetare
            hideError();
            resultContainer.style.display = 'none';
            segmentsPreview.style.display = 'none';
            loading.style.display = 'block';
            processBtn.disabled = true;
            quickPreviewBtn.disabled = true;
            testUploadBtn.disabled = true;
            progressContainer.style.display = 'block';
            processingInfo.style.display = 'none';
            formatInfo.style.display = 'none';
            largeFileWarning.style.display = 'none';
            
            // Setează tema pentru fișiere mari
            if (isLargeFile) {
                loading.classList.add('large-file');
                progressContainer.classList.add('large-file');
                loadingDetailText.textContent = 'Upload optimizat pentru fișier mare...';
                loadingDetails.style.display = 'block';
            } else {
                loading.classList.remove('large-file');
                progressContainer.classList.remove('large-file');
                loadingDetails.style.display = 'none';
            }
            
            // Reset progress
            updateProgress(0, 'Se pregătește...');
            
            const fileSizeMB = selectedFile.size / (1024 * 1024);
            
            // Pentru fișiere mari (>100MB), folosește upload chunked
            if (isLargeFile) {
                await uploadLargeFile();
            } else {
                await uploadSmallFile();
            }
        }
        
        async function uploadSmallFile() {
            // Upload normal pentru fișiere mici
            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('model', currentModel);
            formData.append('language', currentLanguage);
            formData.append('translation_target', translationTarget || '');
            formData.append('adjust_segmentation', adjustSegmentationCheckbox.checked);
            
            try {
                updateProgress(10, 'Se încarcă fișierul...');
                
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                updateProgress(50, 'Se procesează...');
                
                const data = await response.json();
                
                if (data.success) {
                    updateProgress(100, 'Finalizare...');
                    handleSuccessResponse(data);
                } else {
                    throw new Error(data.error || 'Eroare necunoscută');
                }
                
            } catch (error) {
                handleError(error);
            }
        }
        
        async function uploadLargeFile() {
            // Upload chunked pentru fișiere mari
            const chunkSize = 5 * 1024 * 1024; // 5MB chunks
            totalChunks = Math.ceil(selectedFile.size / chunkSize);
            currentChunk = 0;
            uploadStartTime = Date.now();
            
            // Afișează detaliile upload-ului
            uploadDetails.style.display = 'block';
            statTotalSize.textContent = `${(selectedFile.size / (1024 * 1024)).toFixed(1)} MB`;
            statChunks.textContent = totalChunks;
            statCurrentChunk.textContent = '0';
            chunkInfo.innerHTML = `<i class="fas fa-sync-alt fa-spin"></i> Pregătire upload...`;
            
            debugLog(`Încep upload pentru ${selectedFile.name} (${totalChunks} chunks)`);
            showToast(`Încep upload pentru fișier mare (${totalChunks} chunks)...`, 'warning');
            
            // Generează un ID unic pentru upload
            uploadId = 'upload_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            // Începe verificarea progresului
            startUploadProgressCheck();
            
            try {
                let start = 0;
                
                for (let chunkIndex = 1; chunkIndex <= totalChunks; chunkIndex++) {
                    currentChunk = chunkIndex;
                    const end = Math.min(start + chunkSize, selectedFile.size);
                    const chunk = selectedFile.slice(start, end);
                    
                    // Calculează viteza
                    const elapsedSeconds = (Date.now() - uploadStartTime) / 1000;
                    const uploadedMB = (start / (1024 * 1024));
                    const speed = elapsedSeconds > 0 ? (uploadedMB / elapsedSeconds).toFixed(1) : '0.0';
                    
                    // Actualizează statistici
                    statCurrentChunk.textContent = `${chunkIndex}`;
                    statSpeed.textContent = `${speed} MB/s`;
                    chunkInfo.innerHTML = `<i class="fas fa-upload"></i> Se încarcă chunk ${chunkIndex}/${totalChunks} (${(chunk.size/(1024*1024)).toFixed(1)} MB)`;
                    
                    const chunkProgress = (chunkIndex / totalChunks) * 50; // 50% pentru upload
                    updateProgress(chunkProgress, `Se încarcă chunk ${chunkIndex}/${totalChunks}...`);
                    
                    const chunkFormData = new FormData();
                    chunkFormData.append('file', chunk);
                    chunkFormData.append('resumableChunkNumber', chunkIndex.toString());
                    chunkFormData.append('resumableTotalChunks', totalChunks.toString());
                    chunkFormData.append('resumableChunkSize', chunkSize.toString());
                    chunkFormData.append('resumableTotalSize', selectedFile.size.toString());
                    chunkFormData.append('resumableIdentifier', selectedFile.size + '-' + selectedFile.name);
                    chunkFormData.append('resumableFilename', selectedFile.name);
                    chunkFormData.append('model', currentModel);
                    chunkFormData.append('language', currentLanguage);
                    chunkFormData.append('translation_target', translationTarget || '');
                    chunkFormData.append('adjust_segmentation', adjustSegmentationCheckbox.checked);
                    
                    debugLog(`Încarc chunk ${chunkIndex}/${totalChunks} (${(chunk.size/(1024*1024)).toFixed(1)} MB)`);
                    
                    const response = await fetch('/upload', {
                        method: 'POST',
                        body: chunkFormData,
                        signal: AbortSignal.timeout(300000) // 5 minute timeout per chunk
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Eroare la chunk ${chunkIndex}: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(`Eroare la chunk ${chunkIndex}: ${result.error || 'Unknown'}`);
                    }
                    
                    // Dacă avem upload_id, îl folosim
                    if (result.upload_id) {
                        uploadId = result.upload_id;
                        debugLog(`Primit upload_id: ${uploadId}`);
                    }
                    
                    start = end;
                }
                
                debugLog('Upload chunks complet. Aștept procesare...');
                chunkInfo.innerHTML = `<i class="fas fa-check-circle" style="color: #48bb78;"></i> Upload complet! Se procesează...`;
                
                // Așteaptă finalizarea procesării
                updateProgress(75, 'Upload complet, se procesează...');
                
                // Așteaptă maxim 10 minute pentru procesare
                await waitForProcessing();
                
            } catch (error) {
                debugLog(`Eroare upload: ${error.message}`);
                stopUploadProgressCheck();
                handleError(error);
            }
        }
        
        function startUploadProgressCheck() {
            if (uploadCheckInterval) {
                clearInterval(uploadCheckInterval);
            }
            
            uploadCheckInterval = setInterval(async () => {
                if (!uploadId) return;
                
                try {
                    const response = await fetch(`/upload_progress?upload_id=${uploadId}`);
                    const data = await response.json();
                    
                    debugLog(`Status upload: ${JSON.stringify(data)}`);
                    
                    if (data.status === 'processing') {
                        updateProgress(80, 'Se transcrie audio-ul...');
                        chunkInfo.innerHTML = `<i class="fas fa-microphone-alt fa-spin"></i> Se transcrie audio...`;
                    } else if (data.status === 'completed' && data.result) {
                        stopUploadProgressCheck();
                        updateProgress(100, 'Finalizare...');
                        setTimeout(() => {
                            handleSuccessResponse(data.result);
                        }, 1000);
                    } else if (data.status === 'error') {
                        stopUploadProgressCheck();
                        throw new Error(data.error || 'Eroare la procesare');
                    } else if (data.percentage) {
                        // Actualizează progresul
                        const uploadPercent = 50 + (data.percentage / 2); // 50% pentru upload + 50% pentru procesare
                        updateProgress(uploadPercent, `Se procesează... ${data.percentage}%`);
                    }
                } catch (error) {
                    debugLog(`Eroare verificare progres: ${error.message}`);
                }
            }, 3000); // Verifică la fiecare 3 secunde
        }
        
        function stopUploadProgressCheck() {
            if (uploadCheckInterval) {
                clearInterval(uploadCheckInterval);
                uploadCheckInterval = null;
            }
        }
        
        async function waitForProcessing() {
            // Așteaptă maxim 10 minute (600 secunde)
            const maxWaitTime = 600000; // 10 minute în milisecunde
            const checkInterval = 5000; // Verifică la fiecare 5 secunde
            const startTime = Date.now();
            
            return new Promise((resolve, reject) => {
                const checkIntervalId = setInterval(async () => {
                    if (Date.now() - startTime > maxWaitTime) {
                        clearInterval(checkIntervalId);
                        reject(new Error('Timeout la așteptarea procesării'));
                        return;
                    }
                    
                    if (!uploadId) {
                        clearInterval(checkIntervalId);
                        resolve();
                        return;
                    }
                    
                    try {
                        const response = await fetch(`/upload_progress?upload_id=${uploadId}`);
                        const data = await response.json();
                        
                        debugLog(`Status procesare: ${data.status}`);
                        
                        if (data.status === 'completed' && data.result) {
                            clearInterval(checkIntervalId);
                            resolve(data.result);
                        } else if (data.status === 'error') {
                            clearInterval(checkIntervalId);
                            reject(new Error(data.error || 'Eroare la procesare'));
                        }
                    } catch (error) {
                        // Continuă să aștepte
                        debugLog(`Eroare verificare status: ${error.message}`);
                    }
                }, checkInterval);
            });
        }
        
        function handleSuccessResponse(data) {
            // Salvează datele
            srtFilename = data.filename;
            processId = data.process_id;
            currentSegments = data.segments;
            originalSegments = data.original_segments || [];
            imagePreviewUrl = data.image_preview_url;
            videoPreviewUrl = data.video_preview_url;
            videoDuration = data.video_duration || data.total_duration;
            isMp4File = data.is_mp4 || false;
            
            // Afișează textul complet
            document.getElementById('fullText').textContent = data.full_text;
            
            // Afișează segmentele
            displaySegments(currentSegments);
            
            // Afișează informații procesare
            const fileSizeDisplay = data.file_size_mb || (selectedFile ? (selectedFile.size / (1024 * 1024)).toFixed(1) : '0');
            infoModel.textContent = `${data.model_used} ${isMp4File ? '(MP4 direct)' : `(${data.original_format} → MP4)`}`;
            infoTime.textContent = data.processing_time;
            infoLanguage.textContent = data.language_used;
            infoFileSize.textContent = `${fileSizeDisplay} MB`;
            
            if (isLargeFile) {
                infoModel.parentElement.classList.add('large-file');
                infoTime.parentElement.classList.add('large-file');
                infoLanguage.parentElement.classList.add('large-file');
                infoFileSize.parentElement.classList.add('large-file');
            }
            
            processingInfo.style.display = 'block';
            
            // Actualizează video preview dacă există
            if (data.is_video) {
                if (videoPreviewUrl) {
                    videoPreview.src = videoPreviewUrl;
                    videoPreview.style.display = 'block';
                    imagePreview.style.display = 'none';
                } else if (imagePreviewUrl) {
                    imagePreview.src = imagePreviewUrl;
                    imagePreview.style.display = 'block';
                    videoPreview.style.display = 'none';
                }
                videoPreviewContainer.style.display = 'block';
                totalTimeElement.textContent = formatTime(videoDuration);
                playWithSubtitlesBtn.style.display = 'inline-flex';
            } else {
                playWithSubtitlesBtn.style.display = 'none';
            }
            
            // Arată rezultatele
            setTimeout(() => {
                loading.style.display = 'none';
                progressContainer.style.display = 'none';
                uploadDetails.style.display = 'none';
                loadingDetails.style.display = 'none';
                resultContainer.style.display = 'block';
                
                if (isLargeFile) {
                    showToast('Procesare completă pentru fișier mare!', 'success');
                } else {
                    showToast('Transcriere completă cu succes!', 'success');
                }
                
                // Reset upload ID
                uploadId = null;
                stopUploadProgressCheck();
                
            }, 500);
        }
        
        function handleError(error) {
            loading.style.display = 'none';
            progressContainer.style.display = 'none';
            uploadDetails.style.display = 'none';
            loadingDetails.style.display = 'none';
            showError(`Eroare: ${error.message}`);
            processBtn.disabled = false;
            quickPreviewBtn.disabled = false;
            testUploadBtn.disabled = false;
            
            // Reset upload ID
            uploadId = null;
            stopUploadProgressCheck();
            
            debugLog(`Eroare procesare: ${error.message}`);
        }
        
        // Afișează segmentele
        function displaySegments(segments) {
            let segmentsHtml = '';
            
            segments.forEach(segment => {
                segmentsHtml += `
                    <div class="segment" data-start="${segment.start}" data-end="${segment.end}">
                        <div class="segment-header">
                            <span><i class="fas fa-hashtag"></i> #${segment.id}</span>
                            <span><i class="far fa-clock"></i> ${segment.start_formatted} → ${segment.end_formatted}</span>
                        </div>
                        <div class="segment-text">${segment.text}</div>
                    </div>
                `;
            });
            
            document.getElementById('segmentsList').innerHTML = segmentsHtml;
        }
        
        // Rulează video cu subtitrări sincronizate
        function playVideoWithSubtitles() {
            if (!currentSegments.length) {
                showToast('Nu există subtitrări pentru a fi afișate', 'error');
                return;
            }
            
            if (!videoPlaying) {
                startPlayback();
            } else {
                stopPlayback();
            }
        }
        
        function startPlayback() {
            videoPlaying = true;
            playVideoBtn.innerHTML = '<i class="fas fa-pause"></i> Pauză';
            
            // Verifică dacă avem video real sau doar imagine
            if (videoPreviewUrl && videoPreview.src) {
                // Avem video real (MP4 direct sau convertit)
                videoPreview.currentTime = 0;
                videoPreview.play();
                
                // Actualizează timpul curent din video
                videoPreview.ontimeupdate = function() {
                    const currentTime = videoPreview.currentTime;
                    currentTimeElement.textContent = formatTime(currentTime);
                    updateCurrentSubtitle(currentTime);
                };
                
                // La sfârșitul video-ului
                videoPreview.onended = function() {
                    stopPlayback();
                    showToast('Playback terminat', 'info');
                };
            } else {
                // Simulare playback (pentru imagini sau fișiere audio)
                startSimulatedPlayback();
            }
        }
        
        function startSimulatedPlayback() {
            let currentTime = 0;
            const duration = videoDuration || currentSegments[currentSegments.length - 1].end + 5;
            
            videoPlayInterval = setInterval(() => {
                if (!videoPlaying) {
                    clearInterval(videoPlayInterval);
                    return;
                }
                
                currentTime += 0.1; // 100ms = 0.1 secunde
                
                if (currentTime >= duration) {
                    stopPlayback();
                    showToast('Playback terminat', 'info');
                    return;
                }
                
                // Actualizează timpul afișat
                currentTimeElement.textContent = formatTime(currentTime);
                
                // Actualizează subtitrarea
                updateCurrentSubtitle(currentTime);
            }, 100);
        }
        
        function updateCurrentSubtitle(currentTime) {
            // Găsește subtitrarea curentă
            const segment = currentSegments.find(s => 
                currentTime >= s.start && currentTime <= s.end
            );
            
            if (segment) {
                const segmentIndex = currentSegments.indexOf(segment);
                if (segmentIndex !== currentSegmentIndex) {
                    currentSegmentIndex = segmentIndex;
                    currentSubtitle.textContent = segment.text;
                    subtitleTimestamp.textContent = `${segment.start_formatted} → ${segment.end_formatted}`;
                    subtitleOverlay.style.display = 'block';
                    
                    // Evidențiază segmentul în listă (fără auto-scroll)
                    highlightCurrentSegment(segmentIndex);
                }
            } else {
                if (currentSubtitle.textContent !== '') {
                    currentSubtitle.textContent = '';
                    subtitleTimestamp.textContent = '';
                    subtitleOverlay.style.display = 'none';
                    currentSegmentIndex = -1;
                }
            }
        }
        
        function highlightCurrentSegment(index) {
            // Elimină evidențierea anterioară
            document.querySelectorAll('.segment').forEach(seg => {
                seg.classList.remove('highlighted');
            });
            
            // Evidențiază segmentul curent
            const segments = document.querySelectorAll('.segment');
            if (segments[index]) {
                segments[index].classList.add('highlighted');
                
                // Arată butonul pentru scroll manual
                scrollToCurrentBtn.style.display = 'flex';
            }
        }
        
        function stopPlayback() {
            videoPlaying = false;
            playVideoBtn.innerHTML = '<i class="fas fa-play"></i> Play cu Subtitrări';
            
            if (videoPreviewUrl && videoPreview.pause) {
                videoPreview.pause();
                videoPreview.ontimeupdate = null;
                videoPreview.onended = null;
            }
            
            if (videoPlayInterval) {
                clearInterval(videoPlayInterval);
                videoPlayInterval = null;
            }
            
            // Reset subtitles
            currentSubtitle.textContent = '';
            subtitleTimestamp.textContent = '';
            subtitleOverlay.style.display = 'none';
            currentSegmentIndex = -1;
            
            // Ascunde butonul de scroll
            hideScrollButton();
            
            // Elimină evidențierea
            document.querySelectorAll('.segment').forEach(seg => {
                seg.classList.remove('highlighted');
            });
        }
        
        // Formatează timpul (secunde în HH:MM:SS)
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function updateProgress(percent, text) {
            progressFill.style.width = `${percent}%`;
            progressText.textContent = text;
        }
        
        function downloadSRT() {
            if (!srtFilename || !processId) {
                showToast('Nu există fișier SRT pentru descărcare', 'error');
                return;
            }
            
            // Deschide linkul de descărcare într-o nouă filă
            window.open(`/download/${processId}/${encodeURIComponent(srtFilename)}`, '_blank');
        }
        
        function playWithSubtitles() {
            if (videoPreviewContainer.style.display === 'none') {
                videoPreviewContainer.style.display = 'block';
            }
            playVideoWithSubtitles();
        }
        
        // Funcții pentru scroll manual
        function scrollToCurrentSegment() {
            if (currentSegmentIndex >= 0 && currentSegmentIndex < currentSegments.length) {
                const segments = document.querySelectorAll('.segment');
                if (segments[currentSegmentIndex]) {
                    segments[currentSegmentIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }
        
        function hideScrollButton() {
            scrollToCurrentBtn.style.display = 'none';
        }
        
        function resetApp() {
            // Stop playback dacă rulează
            stopPlayback();
            
            // Stop upload progress check
            stopUploadProgressCheck();
            
            selectedFile = null;
            srtFilename = '';
            processId = null;
            currentSegments = [];
            originalSegments = [];
            previewSegments = [];
            videoPreviewUrl = null;
            imagePreviewUrl = null;
            isVideoFile = false;
            isMp4File = false;
            videoDuration = 0;
            videoPlaying = false;
            videoPlayInterval = null;
            currentSegmentIndex = -1;
            isLargeFile = false;
            uploadId = null;
            totalChunks = 0;
            currentChunk = 0;
            
            uploadText.textContent = 'Trage și plasează fișierul aici sau click pentru a selecta';
            processBtn.disabled = true;
            quickPreviewBtn.disabled = true;
            testUploadBtn.disabled = false;
            resultContainer.style.display = 'none';
            processingInfo.style.display = 'none';
            segmentsPreview.style.display = 'none';
            videoPreviewContainer.style.display = 'none';
            uploadDetails.style.display = 'none';
            loading.style.display = 'none';
            progressContainer.style.display = 'none';
            loadingDetails.style.display = 'none';
            formatInfo.style.display = 'none';
            largeFileWarning.style.display = 'none';
            hideError();
            hideScrollButton();
            
            // Reset file size badge
            fileSizeBadge.style.display = 'none';
            fileSizeBadge.classList.remove('large-file');
            
            // Reset upload area
            uploadArea.classList.remove('large-file');
            
            // Reset video element
            videoPreview.src = '';
            videoPreview.style.display = 'none';
            imagePreview.src = '';
            imagePreview.style.display = 'none';
            
            // Reset file input
            fileInput.value = '';
            
            // Reset subtitles
            currentSubtitle.textContent = '';
            subtitleTimestamp.textContent = '';
            subtitleOverlay.style.display = 'none';
            currentTimeElement.textContent = '00:00:00';
            totalTimeElement.textContent = '00:00:00';
            playVideoBtn.innerHTML = '<i class="fas fa-play"></i> Play cu Subtitrări';
            
            // Reset evidențiere
            document.querySelectorAll('.segment').forEach(seg => {
                seg.classList.remove('highlighted');
            });
            
            showToast('Aplicație resetată', 'info');
            debugLog('Aplicație resetată');
        }
        
        function showError(message) {
            errorArea.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            errorArea.style.display = 'block';
        }
        
        function hideError() {
            errorArea.style.display = 'none';
        }
        
        function showToast(message, type = 'info') {
            // Șterge toast-urile anterioare
            document.querySelectorAll('.toast').forEach(toast => toast.remove());
            
            // Creează noul toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'check' : 
                        type === 'error' ? 'exclamation' : 
                        type === 'warning' ? 'exclamation-triangle' : 'info';
            toast.innerHTML = `<i class="fas fa-${icon}-circle"></i> ${message}`;
            
            document.body.appendChild(toast);
            
            // Șterge după 5 secunde
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }
    </script>
</body>
</html>